<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角関数 暗記アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One&display=swap" rel="stylesheet">
    <!-- KaTeX (数式表示ライブラリ) の追加 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMcApliTMk5isNrqUePcJadFEiB6MxrCASNEwBIi-wsbplBIr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlVwcjN_cw2UqrpbImfxCxgRU9fsFUApRgd8NFxI2GSOe8dDURHWseS4+F+" crossorigin="anonymous"></script>

    <style>
        /* 黒板風のフォントを適用 */
        body {
            font-family: 'Klee One', cursive;
            touch-action: manipulation;
        }
        /* 黒板の背景 */
        .blackboard {
            background-color: #2c3e50;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            border: 10px solid #8B4513; /* 木枠のようなボーダー */
            box-shadow: 0 0 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3);
        }
        /* カードのフリップアニメーション */
        .card {
            perspective: 1000px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            border: 2px solid rgba(255, 255, 255, 0.5);
            background-color: rgba(0, 0, 0, 0.2);
        }
        .card-back {
            transform: rotateY(180deg);
        }
        /* チョーク風のボタン */
        .chalk-button {
            color: #f0f0f0;
            border: 2px solid #f0f0f0;
            background-color: transparent;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
        }
        .chalk-button:hover, .chalk-button.active {
            background-color: #f0f0f0;
            color: #2c3e50;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        /* チョーク風のテキスト */
        .chalk-text {
            color: #f0f0f0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        /* KaTeXのフォントサイズ調整 */
        .katex { font-size: 2.5em !important; }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="blackboard w-full max-w-md mx-auto p-6 rounded-lg">

        <!-- モード選択画面 -->
        <div id="mode-selection">
            <h1 class="text-3xl font-bold text-center mb-6 chalk-text">学習モードを選択</h1>
            
            <div class="mb-6">
                <h2 class="text-xl mb-3 chalk-text">問題形式:</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button id="mode-normal" class="chalk-button p-4 rounded-lg">角度 → 値</button>
                    <button id="mode-inverse" class="chalk-button p-4 rounded-lg">値 → 角度</button>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-xl mb-3 chalk-text">角度の単位:</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button id="unit-degrees" class="chalk-button p-4 rounded-lg">度数法 (°)</button>
                    <button id="unit-radians" class="chalk-button p-4 rounded-lg">弧度法 (π)</button>
                </div>
            </div>

            <button id="start-button" class="w-full chalk-button p-4 rounded-lg text-2xl bg-green-500/50 border-green-400 hover:bg-green-400 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                スタート
            </button>
        </div>

        <!-- フラッシュカード画面 -->
        <div id="flashcard-view" class="hidden">
            <div class="card w-full h-64 sm:h-80 mb-4" onclick="this.classList.toggle('flipped')">
                <div class="card-inner">
                    <!-- カードの表 -->
                    <div class="card-front p-4">
                        <p class="text-xl chalk-text mb-4">問題</p>
                        <h2 id="question-text" class="font-bold chalk-text text-center"></h2>
                    </div>
                    <!-- カードの裏 -->
                    <div class="card-back p-4">
                        <p class="text-xl chalk-text mb-4">答え</p>
                        <h2 id="answer-text" class="font-bold chalk-text text-center"></h2>
                    </div>
                </div>
            </div>
            
            <!-- ヒント表示エリア -->
            <div id="hint-box" class="h-12 p-2 mb-4 text-center chalk-text text-lg rounded-lg flex items-center justify-center">
                &nbsp; <!-- 初期状態は空欄 -->
            </div>

            <!-- 操作ボタン -->
            <div class="grid grid-cols-2 gap-4">
                <button id="hint-button" class="chalk-button p-4 rounded-lg">ヒント</button>
                <button id="next-button" class="chalk-button p-4 rounded-lg">次の問題</button>
            </div>
             <button id="back-to-menu" class="w-full chalk-button p-3 rounded-lg mt-4 text-lg">モード選択に戻る</button>
        </div>

    </div>

    <script>
        // --- データ定義 (KaTeX形式) ---
        const trigData = [
            { deg: 0, rad: "0", sin: "0", cos: "1", tan: "0" },
            { deg: 30, rad: "\\frac{\\pi}{6}", sin: "\\frac{1}{2}", cos: "\\frac{\\sqrt{3}}{2}", tan: "\\frac{1}{\\sqrt{3}}" },
            { deg: 45, rad: "\\frac{\\pi}{4}", sin: "\\frac{1}{\\sqrt{2}}", cos: "\\frac{1}{\\sqrt{2}}", tan: "1" },
            { deg: 60, rad: "\\frac{\\pi}{3}", sin: "\\frac{\\sqrt{3}}{2}", cos: "\\frac{1}{2}", tan: "\\sqrt{3}" },
            { deg: 90, rad: "\\frac{\\pi}{2}", sin: "1", cos: "0", tan: "なし" },
            { deg: 120, rad: "\\frac{2\\pi}{3}", sin: "\\frac{\\sqrt{3}}{2}", cos: "-\\frac{1}{2}", tan: "-\\sqrt{3}" },
            { deg: 135, rad: "\\frac{3\\pi}{4}", sin: "\\frac{1}{\\sqrt{2}}", cos: "-\\frac{1}{\\sqrt{2}}", tan: "-1" },
            { deg: 150, rad: "\\frac{5\\pi}{6}", sin: "\\frac{1}{2}", cos: "-\\frac{\\sqrt{3}}{2}", tan: "-\\frac{1}{\\sqrt{3}}" },
            { deg: 180, rad: "\\pi", sin: "0", cos: "-1", tan: "0" },
            { deg: 210, rad: "\\frac{7\\pi}{6}", sin: "-\\frac{1}{2}", cos: "-\\frac{\\sqrt{3}}{2}", tan: "\\frac{1}{\\sqrt{3}}" },
            { deg: 225, rad: "\\frac{5\\pi}{4}", sin: "-\\frac{1}{\\sqrt{2}}", cos: "-\\frac{1}{\\sqrt{2}}", tan: "1" },
            { deg: 240, rad: "\\frac{4\\pi}{3}", sin: "-\\frac{\\sqrt{3}}{2}", cos: "-\\frac{1}{2}", tan: "\\sqrt{3}" },
            { deg: 270, rad: "\\frac{3\\pi}{2}", sin: "-1", cos: "0", tan: "なし" },
            { deg: 300, rad: "\\frac{5\\pi}{3}", sin: "-\\frac{\\sqrt{3}}{2}", cos: "\\frac{1}{2}", tan: "-\\sqrt{3}" },
            { deg: 315, rad: "\\frac{7\\pi}{4}", sin: "-\\frac{1}{\\sqrt{2}}", cos: "\\frac{1}{\\sqrt{2}}", tan: "-1" },
            { deg: 330, rad: "\\frac{11\\pi}{6}", sin: "-\\frac{1}{2}", cos: "\\frac{\\sqrt{3}}{2}", tan: "-\\frac{1}{\\sqrt{3}}" },
            { deg: 360, rad: "2\\pi", sin: "0", cos: "1", tan: "0" }
        ];

        // --- DOM要素の取得 ---
        const modeSelection = document.getElementById('mode-selection');
        const flashcardView = document.getElementById('flashcard-view');
        const startButton = document.getElementById('start-button');
        const card = document.querySelector('.card');
        const questionText = document.getElementById('question-text');
        const answerText = document.getElementById('answer-text');
        const hintButton = document.getElementById('hint-button');
        const nextButton = document.getElementById('next-button');
        const hintBox = document.getElementById('hint-box');
        const backToMenuButton = document.getElementById('back-to-menu');
        
        // --- 状態管理 ---
        let currentQuestionData = null;
        let settings = {
            mode: null, // 'normal' or 'inverse'
            unit: null  // 'degrees' or 'radians'
        };

        // --- モード選択のロジック ---
        const modeNormalBtn = document.getElementById('mode-normal');
        const modeInverseBtn = document.getElementById('mode-inverse');
        const unitDegreesBtn = document.getElementById('unit-degrees');
        const unitRadiansBtn = document.getElementById('unit-radians');

        modeNormalBtn.addEventListener('click', () => {
            settings.mode = 'normal';
            modeNormalBtn.classList.add('active');
            modeInverseBtn.classList.remove('active');
            checkStartButton();
        });
        modeInverseBtn.addEventListener('click', () => {
            settings.mode = 'inverse';
            modeInverseBtn.classList.add('active');
            modeNormalBtn.classList.remove('active');
            checkStartButton();
        });
        unitDegreesBtn.addEventListener('click', () => {
            settings.unit = 'degrees';
            unitDegreesBtn.classList.add('active');
            unitRadiansBtn.classList.remove('active');
            checkStartButton();
        });
        unitRadiansBtn.addEventListener('click', () => {
            settings.unit = 'radians';
            unitRadiansBtn.classList.add('active');
            unitDegreesBtn.classList.remove('active');
            checkStartButton();
        });
        
        function checkStartButton() {
            if (settings.mode && settings.unit) {
                startButton.disabled = false;
            }
        }

        // --- イベントリスナー ---
        startButton.addEventListener('click', startGame);
        nextButton.addEventListener('click', generateNewQuestion);
        hintButton.addEventListener('click', showHint);
        backToMenuButton.addEventListener('click', () => {
            flashcardView.classList.add('hidden');
            modeSelection.classList.remove('hidden');
            settings.mode = null;
            settings.unit = null;
            document.querySelectorAll('.chalk-button.active').forEach(b => b.classList.remove('active'));
            startButton.disabled = true;
        });

        // --- 関数定義 ---
        function startGame() {
            modeSelection.classList.add('hidden');
            flashcardView.classList.remove('hidden');
            generateNewQuestion();
        }
        
        function generateNewQuestion() {
            if (card.classList.contains('flipped')) {
                card.classList.remove('flipped');
            }
            hintBox.innerHTML = '&nbsp;'; // ヒントをリセット
            hintButton.disabled = false;

            // 'tan'が定義されていない問題のみを対象にする
            let availableData = trigData.filter(d => d.tan !== 'なし');
            
            // 逆引きモードの場合、答えの候補から360°を除外する
            if (settings.mode === 'inverse') {
                availableData = availableData.filter(d => d.deg < 360);
            }
            
            currentQuestionData = availableData[Math.floor(Math.random() * availableData.length)];
            
            // 'sin', 'cos', 'tan' からランダムに選択
            const func = ['sin', 'cos', 'tan'][Math.floor(Math.random() * 3)];

            if (settings.mode === 'normal') {
                const angle = settings.unit === 'degrees' ? `${currentQuestionData.deg}^\\circ` : currentQuestionData.rad;
                const questionString = `\\mathrm{${func}}\\;${angle} = ?`;
                katex.render(questionString, questionText, { throwOnError: false });
                katex.render(currentQuestionData[func], answerText, { throwOnError: false });
            } else {
                const value = currentQuestionData[func];
                const questionString = `\\mathrm{${func}}\\;\\theta = ${value}`;
                questionText.innerHTML = ''; // Clear previous content
                const qSpan = document.createElement('span');
                questionText.appendChild(qSpan);
                katex.render(questionString, qSpan, { throwOnError: false });
                // 範囲のテキストを修正
                questionText.innerHTML += `<br><span class="text-base chalk-text">(0° ≦ θ < 360°)</span>`;

                const angle = settings.unit === 'degrees' ? `${currentQuestionData.deg}^\\circ` : currentQuestionData.rad;
                // 他の答えを探す際も360°を除外する
                const otherAnswers = trigData.filter(d => d[func] === value && d.deg !== currentQuestionData.deg && d.deg < 360);
                let answerString = angle;
                if(otherAnswers.length > 0) {
                    const otherAngle = settings.unit === 'degrees' ? `${otherAnswers[0].deg}^\\circ` : otherAnswers[0].rad;
                    answerString += `, \\; ${otherAngle}`;
                }
                katex.render(answerString, answerText, { throwOnError: false });
            }
        }

        function showHint() {
            if (settings.mode === 'normal') {
                const deg = currentQuestionData.deg;
                 if (deg === 0 || deg === 360) hintBox.textContent = `x軸の正の部分`;
                else if (deg === 90) hintBox.textContent = `y軸の正の部分`;
                else if (deg === 180) hintBox.textContent = `x軸の負の部分`;
                else if (deg === 270) hintBox.textContent = `y軸の負の部分`;
                else if (deg > 0 && deg < 90) hintBox.textContent = `第1象限`;
                else if (deg > 90 && deg < 180) hintBox.textContent = `第2象限`;
                else if (deg > 180 && deg < 270) hintBox.textContent = `第3象限`;
                else hintBox.textContent = `第4象限`;
            } else {
                const func = questionText.textContent.startsWith('sin') ? 'sin' : (questionText.textContent.startsWith('cos') ? 'cos' : 'tan');
                const valueStr = currentQuestionData[func];
                let hint = '';
                 if (func === 'tan') {
                    if (valueStr.includes('-')) hint = '傾きが負 (第2,4象限)';
                    else if (valueStr === '0') hint = '傾きが0 (x軸上)';
                    else hint = '傾きが正 (第1,3象限)';
                } else { // sin or cos
                    if (valueStr.includes('-')) {
                        hint = func === 'sin' ? 'y座標が負 (第3,4象限)' : 'x座標が負 (第2,3象限)';
                    } else if (valueStr === '0') {
                        hint = func === 'sin' ? 'y座標が0 (x軸上)' : 'x座標が0 (y軸上)';
                    } else if (valueStr === '1' || valueStr === '-1') {
                        hint = func === 'sin' ? 'y軸上' : 'x軸上';
                    } else {
                        hint = func === 'sin' ? 'y座標が正 (第1,2象限)' : 'x座標が正 (第1,4象限)';
                    }
                }
                hintBox.textContent = hint;
            }
            hintButton.disabled = true;
        }

    </script>
</body>
</html>
